# ヘルパースクリプト

このプロジェクトには、環境のセットアップ、データベースのインポート、レプリケーションの検証、DMSタスクの管理を支援するための複数のヘルパースクリプトが含まれています。

## 1. setup.sh

すべてのスクリプトに実行権限を付与し、基本的な使用方法を表示するセットアップスクリプトです。

### 使用方法

```bash
./setup.sh
```

### 機能

- 各スクリプトに実行権限を付与
- 基本的なデプロイ手順を表示

## 2. import_sample_db.sh

サンプルデータベース（WorldとEmployees）をダウンロードし、セカンドDBにインポートするスクリプトです。また、マスターDBに空のWorldデータベースを作成します。

### 使用方法

```bash
./import_sample_db.sh <スタック名>
```

### 引数

- `<スタック名>` - Aurora MySQL環境のCloudFormationスタック名

### 機能

- CloudFormationスタックからDB接続情報を取得
- WorldデータベースをダウンロードしてセカンドDBにインポート
- EmployeesデータベースをダウンロードしてセカンドDBにインポート
- マスターDBに空のWorldデータベースを作成

### 処理の流れ

1. CloudFormationスタックからDBエンドポイント情報を取得
2. ユーザーにデータベース認証情報の入力を求める
3. サンプルデータベースをダウンロード
4. セカンドDBにWorldデータベースをインポート
5. セカンドDBにEmployeesデータベースをインポート
6. マスターDBに空のWorldデータベースを作成

## 3. verify_replication.sh

DMSレプリケーションが正常に機能しているかを検証するスクリプトです。

### 使用方法

```bash
./verify_replication.sh <スタック名>
```

### 引数

- `<スタック名>` - Aurora MySQL環境のCloudFormationスタック名

### 機能

- ソースとターゲットのデータベース間でテーブル数を比較
- 各テーブルの行数を比較
- 継続的なレプリケーションをテスト（新しい行を挿入して複製されるか確認）

### 検証項目

1. テーブル数の一致確認
2. 各テーブルの行数の一致確認
3. 新規データの挿入と複製確認

## 4. manage_dms_task.sh

DMSレプリケーションタスクを管理するためのスクリプトです。

### 使用方法

```bash
./manage_dms_task.sh <DMSスタック名> <アクション>
```

### 引数

- `<DMSスタック名>` - DMSレプリケーションのCloudFormationスタック名
- `<アクション>` - 実行するアクション（start, stop, status, restart）

### 機能

- タスクの開始（start）
- タスクの停止（stop）
- タスクのステータス確認（status）
- タスクの再起動（restart）

### アクション詳細

- **start**: 停止状態のタスクを開始
- **stop**: 実行中のタスクを停止
- **status**: タスクの現在のステータスと詳細情報を表示
- **restart**: タスクを停止してから再開

## スクリプトの連携

これらのスクリプトは以下の順序で使用することを想定しています：

1. `setup.sh` - 初期セットアップ
2. `import_sample_db.sh` - サンプルデータベースのインポート
3. `verify_replication.sh` - レプリケーションの検証
4. `manage_dms_task.sh` - 必要に応じてDMSタスクを管理

各スクリプトは独立して実行できますが、環境のセットアップから検証までの一連の流れをサポートするように設計されています。